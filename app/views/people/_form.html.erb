<%= form_for(@person) do |f| %>
  <% if @person.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@person.errors.count, "error") %> prohibited this person from being saved:</h2>

      <ul>
      <% @person.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
      <% end %>

  <div class="field">
    <%= f.label :first_name %><br />
    <%= f.text_field :first_name %>
  </div>
  <div class="field">
    <%= f.label :second_name %><br />
    <%= f.text_field :second_name %>
  </div>
  <div class="field">
    <%= f.label :home_country %><br />
    <%= select_tag(:home_country, options_for_select(@countries)) %>
  </div>
  <div class="field">
    <%= f.label :phone_number %><br />
    <%= f.text_field :phone_number %>
  </div>
  <div class="field">
    <%= f.label :email_address %><br />
    <%= f.text_field :email_address %>
  </div>
  <div class="field">
    <%= f.label :price_method %><br />
    <%= f.select(:price_method, [['on the course', 'course'], ['in advance', 'advance']]) %> 
  </div>
  <div class="field">
    <%= f.label :price_category %><br />
    <%= f.select(:price_category, [['full', 'full'], ['support', 'support'], ['escort', 'escort'], ['discount', 'discount']]) %>
  </div>
  <div class="field">
    <%= f.label :payment %><br />
    <%= f.text_field :payment %>
  </div>
  <h2>Meals</h2>
  <table>
  <tr>
  <th>Date</th>
  <th>Food type</th>
  <th>Meal type</th>
  </tr>
  <% @meal_dates.each do |meal_date| %>
    <%= f.fields_for :meals do |f2| %>
    <tr>
    <td><%= f2.text_field :meal_date, :value => meal_date %></td>
    <td><%= f2.hidden_field :food_type, :class => 'FoodType', :value => 'vegetarian'%></td>
    <td><%= f2.select(:meal_type, [['Lunch', 1], ['Three Meals', 3], ['None', nil]]) %></td>
    </tr>
    <% end %>
  <% end %>
  </table>

  <h2>Children</h2>
  <%= f.fields_for :children do |builder| %>
    <%= render 'child_fields', f: builder %>
  <% end %>
  <%= link_to_add_fields 'Add Children', f, :children %>
  
  <h2>Registrations</h2>
  <table>
  <tr>
    <th>Program name hu</th>
    <th>Program name en</th>
    <th>Price full</th>
    <th>Price member</th>
    <th>Price discount</th>
    <th></th>
  </tr>
<% @programs.each do |program| %>
  <tr>
    <td><%= program.program_name_hu %></td>
    <td><%= program.program_name_en %></td>
    <td><%= program.price_full %></td>
    <td><%= program.price_member %></td>
    <td><%= program.price_discount %></td>
    <td>
    <%= f.fields_for :registrations do |f| %>
      <%= f.check_box :program_id %>
      <%= f.hidden_field :program_id, :value => program.id %>
    <% end %>
    </td>
  </tr>
<% end %>
</table> 
    <%= f.hidden_field :reference_number %>
  <div class="actions">
    <%= f.submit :class => 'RegistrationButton' =%>
  </div>
<% end %>